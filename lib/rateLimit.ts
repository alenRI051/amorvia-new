type Bucket={tokens:number;resetAt:number}; const buckets:Map<string,Bucket>=new Map(); export function rateLimit(ip:string,limit:number,windowMs:number){ const now=Date.now(); const key=ip||'anon'; let b=buckets.get(key); if(!b||now>b.resetAt){ b={tokens:limit-1,resetAt:now+windowMs}; buckets.set(key,b); return {allowed:true,remaining:b.tokens,reset:b.resetAt}; } if(b.tokens<=0) return {allowed:false,remaining:0,reset:b.resetAt}; b.tokens-=1; return {allowed:true,remaining:b.tokens,reset:b.resetAt}; }
